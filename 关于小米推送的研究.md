#关于小米推送的研究

##1.先注册小米应用开发者账号，创建应用获取AppID,Appkey
   
    

  
  
 
#2.在苹果官网创建APNs证书（Apple Push Notification Service）


##1.使用Mac上工具 keychain生成request文件，同时系统自动生成一对RSA密钥。生成的密钥可以在keychain的Login中根据名称查看.



##2.在苹果开发者网站申请对应的APNs证书。大致过程是:

创建AppID 

创建developer证书 

上传刚刚生成的request文件

下载已经生成好的APNs证书

双击证书，系统自动导入证书

有时候这个证书会导入到keychain的system中，我们需要把system中的证书拖动到Login中，让证书与生成的RSA密钥配对

然后再导出P12文件。上传到小米应用商店中对应的App的P12文件


##3.配置小米推送SDK
导入sdk，添加相关库文件
###a.在项目的中plist文件加入以下代码

   	<key>MiSDKAppID</key>
	<string>1000888</string>
	<key>MiSDKAppKey</key>
	<string>500088888888</string>
	<key>MiSDKRun</key>
	<string>Online</string>

###b.注册推送服务


    // 只启动APNs.
    [MiPushSDK registerMiPush:self];
    
###c.推送服务注册成功后，SDK会请求APNs建立连接并获得deviceToken，请求获得deviceToken成功后请调用以下代码来绑定手机设备


	#pragma mark UIApplicationDelegate
 	- (void)application:(UIApplication *)app didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken
 	{
        // 注册APNS成功, 注册deviceToken
        [MiPushSDK bindDeviceToken:deviceToken];
    }

    - (void)application:(UIApplication *)app 
         didFailToRegisterForRemoteNotificationsWithError:(NSError *)err{
    	// 注册APNS失败
    	// 自行处理
    }
    
###d.在AppDelegate中实现MiPushSDKDelegate

在AppDelegate.h中加入MiPushDelegate协议

在AppDelegate.m中实现回调方法
    
    #pragma mark MiPushSDKDelegate
  
     - (void)miPushRequestSuccWithSelector:(NSString *)selector data:(NSDictionary *)data
     {
     	 // 请求成功
     }
  
 	- (void)miPushRequestErrWithSelector:(NSString *)selector error:(int)error data:(NSDictionary *)data
 	{
     	 // 请求失败
 	}


###e.注册推送服务，绑定手机设备成功后，即可调用以下方法

 	// 设置别名           
 	[MiPushSDK setAlias:@“alias”]
  
 	// 订阅内容
 	[MiPushSDK subscribe:@“topic”] 

 	// 设置帐号
	 [MiPushSDK setAccount:@“account”]
	 
##4.在小米推送平台 推送消息，可以指定别名，订阅内容，账号来发送消息

#问题记录：

1.从Mac的keychain中导出带密钥的证书（p12）文件上传到小米推送网站时，从keychain的Login导出的p12文件和从keychain的 system导出的p12文件有区别。小米推送网站不识别从system导出的。具体原因不明。

2.我们从官网上download下来的cer文件是不带密钥的，所以不能导出p12文件。一般我们在官网申请cer文件时，会用keychain生成request文件，在生成request文件的同事，keychain的Login中会生成一对密钥。我们需要把cer文件与这对密钥对应起来。
我们双击cer文件时，cer文件添加到keychain的system中，我们需要把system中的cer文件拖到Login中.这样就匹配上了。
